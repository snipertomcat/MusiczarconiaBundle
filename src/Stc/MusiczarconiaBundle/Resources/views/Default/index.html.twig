{% extends 'StcBaseBundle::layout.html.twig' %}
{% block title %}Studio Reservation App{% endblock %}
{% block stylesheets %}
    {{ parent() }}
    <link href="{{ asset('bundles/stcbase/css/main.css') }}" rel="stylesheet" />
{% endblock %}
{% block head %}
    {{ parent() }}
    <script>
        $(document).ready(function() {
            //get the pre-populated date from the calender when the page loads:
            if ($('#dateSelectorForm').val() == '') {
                var currDate = new Date();
                currDate = currDate.toLocaleDateString();
                //alert(currDate);
                $('#dateclick').attr('value', currDate);

                var request = $.ajax({
                    url: "{{ path('get_reservations_today') }}",
                    type: "POST",
                    data:
                        { formName:$('#dateSelectorForm').attr('id'),
                          dateclick:$('#dateclick').attr('value'),
                          other: "attributes" }
                });
                request.done(function(msg) {
                    $.each(msg.htmlContent, function(idx, obj) {
                        $('#'+obj).css('background-color','black');
                    });
                });
            }
                //$('#dateSelectorForm').submit();
            //listen for form being submitted:
            $('#dateSelectorForm').submit(function() {
                //set all <td>'s to have a white background (for each request)
                $("td").removeAttr('style');
                //get url
                var url=$('#dateSelectorForm').attr('action');
                //start post request:
                $.post(url, {
                    formName:$('#dateSelectorForm').attr('id'),
                    dateclick:$('#dateclick').attr('value'),
                    other:"attributes"
                }, function(data) {
                    //response is in the data variable
                    if(data.responseCode==200) {
                        $.each(data.htmlContent, function(idx, obj) {
                            $('#'+obj).css('background-color','black');
                            //$('#'+obj).html("<span style='background-color: black;'></span> ");
                        });
                    } else if (data.responseCode == '') {
                        $('#daychart').html('<h2>Bad Request</h2>');
                        $('#daychart').css('color','red');
                    } else {
                        //if we get here the controller didn't return a json_encoded resposne:
                        alert("An unexpected error occured");
                        //UN-COMMENT THIS FOR DEBUGGING:
                        //$('#daychart').html(data);
                    }
                });
                return false;
            });
        });

        $(function() {
            $( "#datepicker" ).datepicker({
                inline: true,
                onSelect: function(date) {
                    $('#dateclick').val(date);
                    $('#dateSelectorForm').submit();
                    //window.location = 'http://'+location.host+'/stcbaseapp/web/app_dev.php/display/reservation?date='+date.replace(/\//g,'');
                }
            });
            return false;
        });

    </script>
{% endblock %}
{% block content %}
    <div style="margin-top: 120px">
    {% include 'StcMusiczarconiaBundle:Default:carosel.html.twig' %}
    <!-- Datepicker -->
    {% block fos_user_content %}
        {{ parent() }}
    {% endblock %}
    <div class="reservation_table">
        <form id="dateSelectorForm" action="{{ path('get_daily_view') }}" method="post">
            <input id="dateclick" type="hidden" name="dateclick" />
            <div id="datepicker"></div>
        </form>
    </div>
    <div style="float:left; ">
    <div id="daychart" class="daychart">
        {#{% include 'StcMusiczarconiaBundle:Default:reservation_table.html.twig' %}#}
        {{ render(url('show_reservation_table')) }}
    </div>
    <div id="carosel">
        <div id="carousel-example-generic" class="carousel slide" data-ride="carousel">
            <!-- Indicators -->
            <ol class="carousel-indicators">
                <li data-target="#carousel-example-generic" data-slide-to="0" class="active"></li>
                <li data-target="#carousel-example-generic" data-slide-to="1"></li>
                <li data-target="#carousel-example-generic" data-slide-to="2"></li>
            </ol>

            <!-- Wrapper for slides -->
            <div class="carousel-inner">
                <div class="item active">
                    <img src="..." alt="...">
                    <div class="carousel-caption">
                        ...
                    </div>
                </div>
                ...
            </div>

            <!-- Controls -->
            <a class="left carousel-control" href="#carousel-example-generic" data-slide="prev">
                <span class="glyphicon glyphicon-chevron-left"></span>
            </a>
            <a class="right carousel-control" href="#carousel-example-generic" data-slide="next">
                <span class="glyphicon glyphicon-chevron-right"></span>
            </a>
        </div>

    </div>
    </div>
    </div>
{% endblock %}